@model IEnumerable<BankAndFinance.Models.Card>
@{
    ViewData["Title"] = "Cards Management";
    ViewBag.PageTitle = "Cards Management";
    ViewBag.Breadcrumb = "Banking / Cards";
}

<div class="card fade-in">
    <div class="card-header">
        <div class="card-title">üí≥ All Customer Cards</div>
    </div>
    <div class="table-container">
        @if (TempData["Success"] != null)
        {
            <div class="alert alert-success mx-4 mt-3">@TempData["Success"]</div>
        }
        @if (TempData["Error"] != null)
        {
            <div class="alert alert-error mx-4 mt-3">@TempData["Error"]</div>
        }

        <table>
            <thead>
                <tr>
                    <th>Card ID</th>
                    <th>Customer</th>
                    <th>Account Number</th>
                    <th>Card Number</th>
                    <th>Card Type</th>
                    <th>Status</th>
                    <th>Expiry Date</th>
                    <th>Card Limit</th>
                    <th>Created Date</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @if (Model != null && Model.Any())
                {
                    @foreach (var card in Model)
                    {
                        <tr>
                            <td>#CARD@card.CardId</td>
                            <td>
                                <div style="font-weight: 600;">@card.Account?.User?.FullName</div>
                                <div style="font-size: 12px; color: #64748b;">@card.Account?.User?.Email</div>
                            </td>
                            <td><strong>@card.Account?.AccountNumber</strong></td>
                            <td>
                                <span style="font-family: monospace; background: #f1f5f9; padding: 4px 8px; border-radius: 4px;">
                                    **** **** **** @card.CardNumber.Substring(card.CardNumber.Length - 4)
                                </span>
                            </td>
                            <td>
                                @if (card.CardType == "Debit")
                                {
                                    <span class="badge" style="background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; padding: 6px 12px; border-radius: 6px;">
                                        üí≥ Debit Card
                                    </span>
                                }
                                else
                                {
                                    <span class="badge" style="background: linear-gradient(135deg, #f59e0b, #d97706); color: white; padding: 6px 12px; border-radius: 6px;">
                                        üíé Credit Card
                                    </span>
                                }
                            </td>
                            <td>
                                @if (card.CardStatus == "Active")
                                {
                                    <span class="status-badge status-active">‚úÖ Active</span>
                                }
                                else if (card.CardStatus == "Blocked")
                                {
                                    <span class="status-badge status-pending">üîí Blocked</span>
                                }
                                else
                                {
                                    <span class="status-badge status-failed">‚ùå Inactive</span>
                                }
                            </td>
                            <td>
                                @if (card.ExpiryDate.HasValue)
                                {
                                    var isExpired = card.ExpiryDate.Value < DateTime.Now;
                                    <span style="color: @(isExpired ? "#ef4444" : "#64748b")">
                                        @card.ExpiryDate.Value.ToString("MM/yyyy")
                                        @if (isExpired)
                                        {
                                            <span style="display: block; font-size: 11px; color: #ef4444;">‚ö†Ô∏è Expired</span>
                                        }
                                    </span>
                                }
                                else
                                {
                                    <span style="color: #94a3b8;">N/A</span>
                                }
                            </td>
                            <td>
                                @if (card.CardLimit.HasValue)
                                {
                                    <strong>$@card.CardLimit.Value.ToString("N2")</strong>
                                }
                                else
                                {
                                    <span style="color: #94a3b8;">No Limit</span>
                                }
                            </td>
                            <td style="color: #64748b;">@card.CreatedAt.ToString("MMM dd, yyyy")</td>
                            <td>
                                <a href="@Url.Action("CardDetails", "Admin", new { id = card.CardId })" 
                                   class="btn btn-sm" 
                                   style="background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; padding: 8px 16px; border-radius: 6px; text-decoration: none; display: inline-block;">
                                    üëÅÔ∏è View Details
                                </a>
                            </td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="10" style="text-align: center; padding: 40px; color: #64748b;">
                            No cards found in the system
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<style>
    .alert-success {
        background: #dcfce7;
        color: #16a34a;
        padding: 12px 16px;
        border-radius: 8px;
        border-left: 4px solid #16a34a;
    }
    
    .alert-error {
        background: #fee2e2;
        color: #dc2626;
        padding: 12px 16px;
        border-radius: 8px;
        border-left: 4px solid #dc2626;
    }
</style>
